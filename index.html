<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LÆ°u áº£nh GitHub JSON</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1 { font-size: 20px; }
    .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; }
    img { width: 100%; border: 1px solid #ccc; border-radius: 5px; }
    textarea { width: 100%; margin-top: 5px; font-size: 12px; }
  </style>
</head>
<body>
  <h1>ðŸ“¸ Upload áº¢nh UOD</h1>
  <input type="file" accept="image/*" id="upload" />
  <div id="images" class="grid"></div>

  <script>
    const GITHUB_USER = "Linh2k55555";
    const REPO = "UPD";
    const FILE_PATH = "images.json";
    const BRANCH = "main";
    const TOKEN = "";

    const imagesContainer = document.getElementById("images");
    let images = [];

    async function loadImages() {
      try {
        const res = await fetch(`https://raw.githubusercontent.com/${GITHUB_USER}/${REPO}/${BRANCH}/${FILE_PATH}`);
        images = await res.json();
      } catch {
        images = [];
      }
      renderImages();
    }


    function renderImages() {
      imagesContainer.innerHTML = "";
      images.forEach((img, i) => {
        const div = document.createElement("div");
        div.innerHTML = `
          <img src="${img}" alt="uploaded-${i}">
          <textarea readonly rows="3">${img}</textarea>
        `;
        imagesContainer.appendChild(div);
      });
    }


    async function handleUpload(e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onloadend = async () => {
        const base64 = reader.result;
        const newImages = [...images, base64];

    
        const res = await fetch(
          `https://api.github.com/repos/${GITHUB_USER}/${REPO}/contents/${FILE_PATH}`,
          { headers: { Authorization: `token ${TOKEN}` } }
        );
        const fileData = await res.json();

    
        await fetch(
          `https://api.github.com/repos/${GITHUB_USER}/${REPO}/contents/${FILE_PATH}`,
          {
            method: "PUT",
            headers: {
              Authorization: `token ${TOKEN}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              message: "Add new image",
              content: btoa(JSON.stringify(newImages, null, 2)),
              sha: fileData.sha,
              branch: BRANCH,
            }),
          }
        );

        images = newImages;
        renderImages();
      };
      reader.readAsDataURL(file);
    }

    document.getElementById("upload").addEventListener("change", handleUpload);

    loadImages();
  </script>
</body>
</html>
